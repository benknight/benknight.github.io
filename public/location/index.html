<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width" name="viewport" />
    <title>Location</title>
    <link href="../node_modules/tachyons/css/tachyons.min.css?v=4.11.1" rel="stylesheet">
    <link href="../dark-theme.css" rel="stylesheet" />
    <style>
      html {
        font-size: 18px;
      }

      @media screen and (min-width: 30em) {
        html {
          font-size: 22px;
        }
      }

      .emoji {
        display: inline-block;
        width: 4rem;
        height: 4rem;
        margin-bottom: 1rem;
        line-height: 4.2rem;
        font-size: 2rem;
        text-align: center;
        background: var(--near-black);
        border-radius: 50%;
      }

      li:first-child .emoji {
        box-shadow: inset 0 0 0 2px hsl(200, 100%, 50%);
      }
    </style>
    <script defer src="../node_modules/axios/dist/axios.min.js?v=0.19.0"></script>
    <script defer src="../node_modules/moment/min/moment.min.js?v=2.24.0"></script>
    <script defer>
      function formatDate(...input) {
        const calendar = moment(input[0]).calendar(null, {
          sameElse: function(now) {
            if (this.year() === now.year()) {
              return 'MMMM D';
            }
            return 'LL';
          },
        });
        const days = Math.round(Math.max(1, moment(input[1]).diff(moment(input[0]), 'days', true)));
        return `${calendar} Â· ${days} ${days > 1 ? 'days' : 'day'}`;
      }

      window.addEventListener('DOMContentLoaded', () => {
        axios.get('/getLocations').then(({ data: records }) => {
          const template = document.querySelector('template');
          const root = document.querySelector('#root');

          records.forEach((record, index) => {
            const node = document.importNode(template.content, true);
            node.querySelector('a').setAttribute('href', record['Google Maps Link']);
            node.querySelector('a').append(formatDate(record.Date, (records[index - 1] || {}).Date));
            node.querySelector('.emoji').textContent = record.Emoji;
            node.querySelector('b').textContent = record.Address;
            root.appendChild(node);
          });

          document.querySelector('#loader').remove();
          root.classList.remove('dn');
        });
      });
    </script>
  </head>
  <body class="ma0 pa0 tc">
    <template>
      <li class="mt5">
        <a class="dib link color-inherit">
          <span class="emoji"></span><br />
          <b class="near-white"></b><br />
        </a>
      </li>
    </template>
    <div id="loader" class="pa4">Loading...</div>
    <ul id="root" class="dn list ph4 ph5-l pb5 ma0 tc lh-copy mw8 center">
    </ul>
  </body>
</html>
